Adversarial Autoencoder (encode-decode): An adversarial autoencoder (AAE) augments a standard encoderâ€“decoder with an adversarial objective on the latent code. The encoder maps each input window into a latent vector and the decoder attempts to reconstruct the original window. In parallel, a discriminator is trained to distinguish latent samples produced by the encoder from samples drawn from a chosen prior distribution (e.g., Gaussian). The encoder is trained to fool the discriminator, aligning the aggregated posterior of the latent space with the prior. This regularization encourages the model to represent normal time-series patterns on a compact manifold and to reconstruct them well. Windows that deviate from this learned manifold (anomalies) typically yield larger reconstruction errors. In this example, windows are scored by reconstruction error and events are flagged when the score exceeds a learned threshold.

Objectives: 
This Rmd demonstrates anomaly detection with an adversarial autoencoder (`han_autoencoder(..., autoenc_adv_ed, ...)`). The model learns a robust latent representation; anomalies yield higher reconstruction error. Steps: load packages/data, visualize, define the architecture/epochs, fit, detect, evaluate, and plot.

```{r}
# Install Harbinger (only once, if needed)
#install.packages("harbinger")
```

```{r}
# Load required packages
library(daltoolbox)
library(daltoolboxdp)
library(harbinger) 
```

```{r}
# Load example datasets bundled with harbinger
data(examples_anomalies)
```

```{r}
# Select a simple synthetic time series with labeled anomalies
dataset <- examples_anomalies$simple
head(dataset)
```

```{r}
# Plot the time series
har_plot(harbinger(), dataset$serie)
```

```{r}
# Define adversarial autoencoder-based detector (autoenc_adv_ed)
  model <- han_autoencoder(3, 2, autoenc_adv_ed, num_epochs = 1500)
```

```{r}
# Fit the model
  model <- fit(model, dataset$serie)
```

```{r}
# Detect anomalies (reconstruction error -> events)
  detection <- detect(model, dataset$serie)
```

```{r}
# Show only timestamps flagged as events
  print(detection |> dplyr::filter(event==TRUE))
```

```{r}
# Evaluate detections against ground-truth labels
  evaluation <- evaluate(model, detection$event, dataset$event)
  print(evaluation$confMatrix)
```

```{r}
# Plot detections over the series
  har_plot(model, dataset$serie, detection, dataset$event)
```
```{r}
# Plot residual scores and threshold
  har_plot(model, attr(detection, "res"), detection, dataset$event, yline = attr(detection, "threshold"))
```

References:
- Makhzani, A., Shlens, J., Jaitly, N., Goodfellow, I., & Frey, B. (2016). Adversarial Autoencoders. arXiv:1511.05644.
- Chalapathy, R., & Chawla, S. (2019). Deep Learning for Anomaly Detection: A Survey. arXiv:1901.03407.
