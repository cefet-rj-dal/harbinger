STAMP motif discovery: Matrix Profile methods compute, for each subsequence, the distance to its nearest neighbor subsequence, enabling efficient discovery of repeated patterns (motifs). STAMP uses random sampling to approximate the Matrix Profile with scalability to long series. In Harbinger this is provided via `tsmp` and wrapped by `hmo_mp()`.

Objectives: This Rmd demonstrates motif discovery using Matrix Profile with the STAMP algorithm via `hmo_mp("stamp", ...)`. It finds repeated subsequences (motifs) in a time series. Steps: load packages/data, visualize the series, define the motif model (subsequence length and number of motifs), fit, detect, evaluate, and plot.

```{r}
# Install Harbinger (only once, if needed)
#install.packages("harbinger")
```

```{r}
# Load required packages
library(daltoolbox)
library(harbinger) 
```

```{r}
# Load example datasets bundled with harbinger
data(examples_motifs)
```

```{r}
# Select a simple example time series
dataset <- examples_motifs$simple
head(dataset)
```

```{r}
# Plot the time series
har_plot(harbinger(), dataset$serie)
```

```{r}
# Define Matrix Profile (STAMP) motif model
# - first arg: algorithm name
# - second arg: subsequence length (window)
# - third arg: number of motifs to retrieve
  model <- hmo_mp("stamp", 4, 3)
```

```{r}
# Fit the model
  model <- fit(model, dataset$serie)
```

```{r}
# Detect motifs
  detection <- detect(model, dataset$serie)
```

```{r}
# Show only timestamps flagged as events
  print(detection |> dplyr::filter(event==TRUE))
```

```{r}
# Evaluate detections against ground-truth labels
  evaluation <- evaluate(model, detection$event, dataset$event)
  print(evaluation$confMatrix)
```

```{r}
# Plot detections over the series
  har_plot(model, dataset$serie, detection, dataset$event)
  
```

References 
- Yeh, C.-C. M., et al. (2016). Matrix Profile I/II: All-pairs similarity joins and scalable time series motif/discord discovery. IEEE ICDM.
- Tavenard, R., et al. (2020). tsmp: The Matrix Profile in R. The R Journal. doi:10.32614/RJ-2020-021
